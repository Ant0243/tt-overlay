<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>TT Overlay Pro</title>

  <style>
    :root{
      --bg: rgba(12,14,18,.88);
      --stroke: rgba(255,255,255,.08);
      --text: rgba(255,255,255,.95);
      --accentA: #0070ff;
      --accentB: #f80000;
    }

    html,body{
      margin:0;
      background:transparent;
      font-family:-apple-system,system-ui;
    }

    .overlay{
      position:fixed;
      bottom:28px;
      left:28px;
      width:420px;
      color:var(--text);
    }

    .banners{
      position:absolute;
      bottom:135px;
      width:100%;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:6px;
    }

    .banner{
      display:none;
      padding:8px 22px;
      border-radius:8px;
      font-weight:700;
      background:rgba(0,0,0,.85);
      font-size:14px;
    }

    .banner.timeout{ border:2px solid #FFC107; }
    .banner.match{ border:2px solid #FF1744; }

    .card{
      background:var(--bg);
      border:1px solid var(--stroke);
      border-radius:14px;
      overflow:hidden;
      backdrop-filter:blur(12px);
    }

    .row{
      display:grid;
      grid-template-columns:1fr 16px auto 60px;
      align-items:center;
      gap:10px;
      padding:14px;
    }

    .row + .row{
      border-top:1px solid rgba(255,255,255,.08);
    }

    .row.a{ box-shadow: inset 7px 0 0 var(--accentB); }
    .row.b{ box-shadow: inset 7px 0 0 var(--accentA); }

    .nameWrap{
      display:grid;
      grid-template-columns:1fr 18px;
      align-items:center;
      gap:8px;
    }

    .name{
      font-weight:600;
      overflow:hidden;
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient:vertical;
    }

    .service{
      font-size:12px;
      opacity:0;
      transition:.2s ease;
    }
    .service.on{
      opacity:1;
      transform:translateX(3px);
    }

    .timeoutIcon{
      font-size:11px;
      opacity:.2;
      justify-self:end;
    }
    .timeoutIcon.on{ opacity:1; }

    .sets{ display:flex; gap:6px; }

    .set{
      width:11px;
      height:11px;
      border-radius:3px;
      background:rgba(255,255,255,.15);
    }
    .set.b{ background:var(--accentA); }
    .set.a{ background:var(--accentB); }

    .score{
      font-size:30px;
      font-weight:900;
      text-align:right;
    }
  </style>
</head>

<body>

<div class="overlay">

  <div class="banners">
    <div class="banner timeout" id="timeoutBanner">TEMPS MORT</div>
    <div class="banner match" id="matchBanner">BALLE DE MATCH</div>
  </div>

  <div class="card">

    <div class="row a">
      <div class="nameWrap">
        <span class="name" id="nameA">JOUEUR A</span>
        <span class="timeoutIcon" id="toA">ðŸ•’</span>
      </div>
      <div class="service" id="serveA">â–¶</div>
      <div class="sets" id="setsA"></div>
      <div class="score" id="scoreA">0</div>
    </div>

    <div class="row b">
      <div class="nameWrap">
        <span class="name" id="nameB">JOUEUR B</span>
        <span class="timeoutIcon" id="toB">ðŸ•’</span>
      </div>
      <div class="service" id="serveB">â–¶</div>
      <div class="sets" id="setsB"></div>
      <div class="score" id="scoreB">0</div>
    </div>

  </div>
</div>

<script>
  const socket = new WebSocket(
          (location.protocol === "https:" ? "wss://" : "ws://")
          + location.host + "?token=moncode123"
  );

  const el = id => document.getElementById(id);
  let bestOf = 5;

  function teamName(st, team){
    if(team==="A"){
      return st.mode==="doubles" && st.A2
              ? st.A1+" / "+st.A2
              : st.A1;
    }else{
      return st.mode==="doubles" && st.B2
              ? st.B1+" / "+st.B2
              : st.B1;
    }
  }

  function renderSets(container,count,team){
    container.innerHTML="";
    const needed = Math.ceil(bestOf/2);
    for(let i=0;i<needed;i++){
      const d=document.createElement("div");
      d.className="set";
      if(i<count){
        d.classList.add(team==="A"?"a":"b");
      }
      container.appendChild(d);
    }
  }

  socket.onmessage = (event)=>{
    const st = JSON.parse(event.data);

    bestOf = st.bestOf || 5;

    el("nameA").textContent = teamName(st,"A");
    el("nameB").textContent = teamName(st,"B");

    el("scoreA").textContent = st.pointsA;
    el("scoreB").textContent = st.pointsB;

    renderSets(el("setsA"),st.setsA,"A");
    renderSets(el("setsB"),st.setsB,"B");

    // SERVICE
    if(!st.matchStarted || !st.server){
      el("serveA").classList.remove("on");
      el("serveB").classList.remove("on");
    }else{
      el("serveA").classList.toggle("on", st.server==="A");
      el("serveB").classList.toggle("on", st.server==="B");
    }

    // TIMEOUT
    el("timeoutBanner").style.display =
            st.timeoutActive ? "block":"none";

    // MATCH POINT
    if(st.matchPointFor === "A" || st.matchPointFor === "B"){
      el("matchBanner").style.display = "block";
    }else{
      el("matchBanner").style.display = "none";
    }

    // Timeout used icon
    el("toA").classList.toggle("on",st.timeoutUsedA);
    el("toB").classList.toggle("on",st.timeoutUsedB);
  };
</script>

</body>
</html>
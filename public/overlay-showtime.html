<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>TT GRAND FINALE</title>

  <style>
    html,body{
      margin:0;
      height:100%;
      overflow:hidden;
      background:black;
      font-family:-apple-system,system-ui;
    }

    /* BACKGROUND ENERGIE */
    .bg{
      position:fixed;
      inset:0;
      background:radial-gradient(circle at center, #1a1aff, #000);
      animation:pulseBg 4s infinite alternate;
    }
    @keyframes pulseBg{
      from{transform:scale(1);}
      to{transform:scale(1.1);}
    }

    /* LIGHT IMPACT */
    .light{
      position:fixed;
      inset:0;
      background:radial-gradient(circle,rgba(255,255,255,.6),transparent 60%);
      opacity:0;
      pointer-events:none;
    }
    .light.play{
      animation:lightFlash .8s ease;
    }
    @keyframes lightFlash{
      0%{opacity:1;transform:scale(.5);}
      100%{opacity:0;transform:scale(2);}
    }

    /* MAIN */
    .wrap{
      position:fixed;
      inset:0;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      text-align:center;
      color:white;
      opacity:0;
      transform:scale(.8);
      transition:1s ease;
    }
    .wrap.show{
      opacity:1;
      transform:scale(1);
    }

    /* TITLE */
    .title{
      font-size:110px;
      font-weight:900;
      letter-spacing:10px;
      text-transform:uppercase;
      background:linear-gradient(90deg,#fff,#ff4dff,#00c3ff);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      animation:shine 3s linear infinite;
    }
    @keyframes shine{
      0%{filter:hue-rotate(0deg);}
      100%{filter:hue-rotate(360deg);}
    }

    /* WINNER */
    .winner{
      font-size:120px;
      font-weight:900;
      margin-top:40px;
      text-shadow:0 0 40px rgba(255,255,255,.8);
      animation:dropIn 1s cubic-bezier(.2,1,.2,1);
    }
    @keyframes dropIn{
      from{transform:translateY(-200px);opacity:0;}
      to{transform:translateY(0);opacity:1;}
    }

    /* FINAL SCORE */
    .score{
      font-size:80px;
      margin-top:20px;
      animation:pulse 1.5s infinite alternate;
    }
    @keyframes pulse{
      from{transform:scale(1);}
      to{transform:scale(1.1);}
    }

    /* SET DETAILS */
    .sets{
      display:flex;
      gap:25px;
      margin-top:60px;
    }
    .set{
      padding:20px 30px;
      font-size:32px;
      background:rgba(255,255,255,.1);
      border-radius:14px;
      animation:slideUp 1s ease forwards;
    }
    @keyframes slideUp{
      from{opacity:0;transform:translateY(60px);}
      to{opacity:1;transform:translateY(0);}
    }

    /* PARTICULES */
    canvas{
      position:fixed;
      inset:0;
      z-index:-1;
    }
  </style>
</head>
<body>

<div class="bg"></div>
<div class="light" id="light"></div>
<canvas id="particles"></canvas>

<div class="wrap" id="wrap">
  <div class="title">Victoire</div>
  <div class="winner" id="winnerName"></div>
  <div class="score" id="finalScore"></div>
  <div class="sets" id="setList"></div>
</div>

<script>
  const socket=new WebSocket(
          location.protocol==="https:"?"wss://"+location.host:"ws://"+location.host
  );

  const el=id=>document.getElementById(id);

  socket.onmessage=(e)=>{
    const st=JSON.parse(e.data);

    if(!st.finished){
      el("wrap").classList.remove("show");
      return;
    }

    el("light").classList.add("play");
    setTimeout(()=>el("light").classList.remove("play"),800);

    el("wrap").classList.add("show");

    const winner=st.setsA>st.setsB?"A":"B";
    const name = winner==="A"?st.A1:st.B1;

    el("winnerName").textContent=name;
    el("finalScore").textContent=`${st.setsA} – ${st.setsB}`;

    const sets=(st.pointHistory||[])
            .filter(p=>p.type==="SET_END")
            .map(p=>p.score);

    const container=el("setList");
    container.innerHTML="";
    sets.forEach((s,i)=>{
      const d=document.createElement("div");
      d.className="set";
      d.textContent=`SET ${i+1}: ${s.a} – ${s.b}`;
      container.appendChild(d);
    });

    createParticles();
  };

  /* PARTICULE SYSTEM */
  const canvas=document.getElementById("particles");
  const ctx=canvas.getContext("2d");
  canvas.width=window.innerWidth;
  canvas.height=window.innerHeight;

  let parts=[];

  function createParticles(){
    parts=[];
    for(let i=0;i<400;i++){
      parts.push({
        x:canvas.width/2,
        y:canvas.height/2,
        dx:(Math.random()-.5)*8,
        dy:(Math.random()-.5)*8,
        r:Math.random()*3+1
      });
    }
    animate();
  }

  function animate(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle="white";

    parts.forEach(p=>{
      ctx.beginPath();
      ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
      ctx.fill();
      p.x+=p.dx;
      p.y+=p.dy;
    });

    requestAnimationFrame(animate);
  }
</script>

</body>
</html>
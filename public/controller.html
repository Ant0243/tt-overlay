<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TT Controller Pro</title>
  <style>
    body{margin:0;background:#0e1117;font-family:-apple-system,system-ui;color:#fff}
    .wrapper{max-width:560px;margin:auto;padding:18px}
    .tabs{display:flex;gap:10px;margin-bottom:14px}
    .tab{flex:1;background:#1f242c;padding:10px;text-align:center;border-radius:10px;cursor:pointer;font-weight:700}
    .tab.active{background:#2F7DFF}
    .page{display:none}
    .page.active{display:block}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:14px 0}
    button{border:none;padding:14px;border-radius:12px;font-weight:800;cursor:pointer}
    button:active{transform:scale(.98)}
    .blue{background: #9b00c5
    }
    .red{background: #0007f8
    }
    .orange{background:#ff9800;color:#111}
    .gray{background:#444}
    .dark{background:#1f242c}
    .full{grid-column:span 2}
    .card{background:#141a22;border-radius:14px;padding:14px;line-height:1.6}
    label{display:block;margin:10px 0 6px;font-weight:700;opacity:.9}
    input,select{width:100%;padding:10px;border-radius:10px;border:none;background:#1a1f27;color:#fff}
    .small{opacity:.8;font-size:12px;margin-top:8px}
    .badge{display:inline-block;padding:2px 8px;border-radius:999px;background:#1f242c;margin-left:6px;font-size:12px}
  </style>
</head>
<body>
<div class="wrapper">

  <div class="tabs">
    <div class="tab active" data-page="match">Match</div>
    <div class="tab" data-page="settings">Paramètres</div>
  </div>

  <!-- MATCH -->
  <div id="match" class="page active">

    <div class="grid">
      <button class="blue" onclick="send('POINT_A')">+1 ÉQUIPE A</button>
      <button class="red" onclick="send('POINT_B')">+1 ÉQUIPE B</button>

      <button class="orange" onclick="send('TIMEOUT_A')">Temps mort A</button>
      <button class="orange" onclick="send('TIMEOUT_B')">Temps mort B</button>

      <button class="gray full" onclick="send('END_TIMEOUT')">Fin temps mort</button>

      <button class="dark" onclick="send('UNDO')">Undo (annuler)</button>
      <button class="dark" onclick="confirmResetMatch()">Reset match</button>

      <button class="gray full" onclick="confirmResetAll()">Reset TOTAL</button>
    </div>

    <div class="card" id="status">Connexion...</div>
    <div class="small">Astuce : Undo annule aussi un set gagné (si c’était la dernière action).</div>
  </div>

  <!-- SETTINGS -->
  <div id="settings" class="page">

    <label>Mode</label>
    <select id="mode">
      <option value="singles">Simple</option>
      <option value="doubles">Double</option>
    </select>

    <label>Équipe A - Joueur 1</label>
    <input id="A1" placeholder="Ex: Dupont">
    <label>Équipe A - Joueur 2 (double)</label>
    <input id="A2" placeholder="Ex: Martin">

    <label>Équipe B - Joueur 1</label>
    <input id="B1" placeholder="Ex: Durand">
    <label>Équipe B - Joueur 2 (double)</label>
    <input id="B2" placeholder="Ex: Jean">

    <label>Format</label>
    <select id="bestOf">
      <option value="3">BO3 (2 sets gagnants)</option>
      <option value="5" selected>BO5 (3 sets gagnants)</option>
    </select>

    <label>Premier serveur</label>
    <select id="server">
      <option value="A">Équipe A</option>
      <option value="B">Équipe B</option>
    </select>

    <label>Inversion de côté auto à chaque set</label>
    <select id="autoSwap">
      <option value="true" selected>Oui</option>
      <option value="false">Non</option>
    </select>

    <div class="grid">
      <button class="blue full" onclick="applySettings()">Appliquer</button>
    </div>

    <div class="card small">
      Le double affiche “A1 / A2” et “B1 / B2”. Si tu restes en simple, A2/B2 sont ignorés.
    </div>
  </div>

</div>

<script>
  const socket = new WebSocket("ws://localhost:8787");
  const statusEl = document.getElementById("status");

  function send(type, extra = {}) {
    socket.send(JSON.stringify({ type, ...extra }));
  }

  function confirmResetMatch(){
    if(confirm("Reset match (points+sets+timeouts) ? Les noms et le format restent.")){
      send("RESET_MATCH");
    }
  }
  function confirmResetAll(){
    if(confirm("Reset TOTAL (tout revient par défaut) ?")){
      send("RESET_ALL");
    }
  }

  function applySettings(){
    const payload = {
      mode: document.getElementById("mode").value,
      A1: document.getElementById("A1").value,
      A2: document.getElementById("A2").value,
      B1: document.getElementById("B1").value,
      B2: document.getElementById("B2").value,
      bestOf: parseInt(document.getElementById("bestOf").value, 10),
      server: document.getElementById("server").value,
      autoSwapSides: document.getElementById("autoSwap").value === "true"
    };
    send("UPDATE_SETTINGS", payload);
  }

  socket.onmessage = (event) => {
    const st = JSON.parse(event.data);

    const nameA = st.mode === "doubles" ? `${st.A1}${st.A2 ? " / " + st.A2 : ""}` : st.A1;
    const nameB = st.mode === "doubles" ? `${st.B1}${st.B2 ? " / " + st.B2 : ""}` : st.B1;

    statusEl.innerHTML = `
    <b>${nameA}</b> <span class="badge">A</span><br>
    Sets: ${st.setsA} — Points: ${st.pointsA} — Timeout utilisé: ${st.timeoutUsedA}<br><br>

    <b>${nameB}</b> <span class="badge">B</span><br>
    Sets: ${st.setsB} — Points: ${st.pointsB} — Timeout utilisé: ${st.timeoutUsedB}<br><br>

    <b>Service :</b> ${st.server}<br>
    <b>Temps mort actif :</b> ${st.timeoutActive}<br>
    <b>Balle de match :</b> ${st.matchPointFor ? st.matchPointFor : "Non"}<br>
    <b>Match fini :</b> ${st.finished}<br>
    <b>Affichage inversé :</b> ${st.displaySwapped}
  `;
  };

  // Tabs
  document.querySelectorAll(".tab").forEach(t=>{
    t.addEventListener("click", ()=>{
      document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
      t.classList.add("active");
      const page = t.dataset.page;
      document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
      document.getElementById(page).classList.add("active");
    });
  });
</script>
</body>
</html>